<body>

<input type="file"
       id="the_input" name="the_input"
       accept="application/wasm" oninput="processInput()">

<script>
function sendJob(wasm) {
  var worker = new Worker('judge.worker.js');
  var oldSize = wasm.length;
  worker.onmessage = (message) => {
    var newSize = message.data.size;
    var missedOpportunity = 1 - newSize / oldSize;
    if (missedOpportunity > 0.01) {
      document.write('Should have ran wasm-opt, could have saved ' +
        Number(100 * missedOpportunity).toFixed(2) + '%.');
    } else {
      document.write('Looks good!');
    }
  };
  worker.postMessage({
    wasm: wasm
  });
}

function processInput(message) {
  var input = document.getElementById('the_input');
  var file = input.files[0];
  const objectURL = window.URL.createObjectURL(file);
  fetch(objectURL)
    .then(response => response.arrayBuffer())
    .then(buffer => {
      var data = new Uint8Array(buffer);
      sendJob(data);
      window.URL.revokeObjectURL(objectURL);
    });
}
</script>

</body>
